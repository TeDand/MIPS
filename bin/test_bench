#!/bin/bash

rm -rfv tests/bin/* > /dev/null 2>&1

for i in tests/src/*.s; do
    ./parser/bin/parser "$i" "tests/bin/#"
done

RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m'
COUNT=0

for k in tests/bin/*.bin; do
	TEST=${k:10}
	TEST=${TEST::-4}
	./"$@" ./"$k"
	RETCODE=$? ;
	EXP=$(head -n 1 tests/src/"$TEST".s)
	EXP=${EXP:2}
	DESC=$(tail -n 1 tests/src/"$TEST".s)
	DESC=${DESC:2}

	if [[ "$RETCODE" == "$EXP" ]] ; then
		echo -e ""$COUNT" , "$TEST" , ${GREEN}PASS${NC} , author , expected :  "$EXP" \t actual :  "$RETCODE" \t description :  "$DESC""
	else
		echo -e ""$COUNT" , "$TEST" , ${RED}FAIL${NC} , author , expected :  "$EXP" \t actual :  "$RETCODE" \t description :  "$DESC""
	fi
	COUNT=$(("$COUNT" + 1))

done
